// 这是您后端 /api/generate-upload-url 接口的正确逻辑示例

app.get('/api/generate-upload-url', (req, res) => {
  // 从请求的查询参数中，获取文件名和文件类型
  const { name, contentType } = req.query;

  if (!name || !contentType) {
    return res.status(400).json({ error: '文件名 (name) 和文件类型 (contentType) 是必需的' });
  }

  // client 是您已初始化的 ali-oss 实例
  try {
    const options = {
      method: 'PUT',
      expires: 3600, // 签名有效期1小时
      headers: {
        // 关键：将从前端获取的 contentType 加入到签名头部
        'Content-Type': contentType 
      }
    };

    // 使用包含正确 headers 的选项来生成签名 URL
    const signedUrl = client.signatureUrl(name, options);

    // 假设您的文件最终访问地址格式如下
    const fileUrl = `https://paper-library-2024.oss-cn-hangzhou.aliyuncs.com/${name}`;

    // 将签名后的上传 URL 和最终文件访问 URL 返回给前端
    res.json({
      uploadUrl: signedUrl,
      fileUrl: fileUrl
    });

  } catch (error) {
    console.error('生成签名 URL 失败:', error);
    res.status(500).json({ error: '生成签名 URL 时发生服务器错误' });
  }
});
